<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compressor Payment Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1300px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #2c3e50, #4a6491);
            color: white;
            padding: 25px 30px;
            text-align: center;
        }
        
        header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        header p {
            opacity: 0.9;
            font-size: 16px;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            padding: 0;
        }
        
        .sidebar {
            flex: 0 0 300px;
            background-color: #f9f9f9;
            padding: 25px;
            border-right: 1px solid #eee;
        }
        
        .content-area {
            flex: 1;
            padding: 25px;
            min-height: 700px;
        }
        
        .section-title {
            font-size: 20px;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4a6491;
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 10px;
            color: #4a6491;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
        }
        
        select, input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        select:focus, input:focus {
            border-color: #4a6491;
            outline: none;
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 5px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
        }
        
        .radio-option input {
            width: auto;
            margin-right: 8px;
        }
        
        .btn {
            display: inline-block;
            background: #4a6491;
            color: white;
            border: none;
            padding: 14px 25px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
            font-weight: 600;
            text-align: center;
            width: 100%;
            margin-top: 10px;
        }
        
        .btn:hover {
            background: #2c3e50;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #545b62;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .btn-success:hover {
            background: #1e7e34;
        }
        
        .btn-danger {
            background: #dc3545;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .btn-info {
            background: #17a2b8;
        }
        
        .btn-info:hover {
            background: #138496;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-warning:hover {
            background: #e0a800;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab.active {
            color: #4a6491;
            border-bottom: 3px solid #4a6491;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .search-box {
            display: flex;
            margin-bottom: 25px;
        }
        
        .search-box input {
            flex: 1;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }
        
        .search-box button {
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            width: auto;
            padding: 12px 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        table th {
            background-color: #4a6491;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        table tr:hover {
            background-color: #f1f5fd;
        }
        
        .bill-details {
            background-color: #f9f9f9;
            padding: 25px;
            border-radius: 8px;
            margin-top: 30px;
            border-left: 5px solid #4a6491;
        }
        
        .bill-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px dashed #ddd;
        }
        
        .bill-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .bill-label {
            font-weight: 600;
            color: #555;
        }
        
        .bill-value {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .total-row {
            font-size: 18px;
            color: #2c3e50;
            background-color: #e8f4ff;
            padding: 10px;
            border-radius: 5px;
        }
        
        .compressor-info {
            background-color: #f0f8ff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-left: 5px solid #4a6491;
        }
        
        .compressor-info h3 {
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #777;
        }
        
        .empty-state i {
            font-size: 60px;
            margin-bottom: 20px;
            color: #ccc;
        }
        
        .empty-state h3 {
            margin-bottom: 10px;
            color: #555;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .action-buttons .btn {
            flex: 1;
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .summary-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            border-top: 4px solid #4a6491;
            text-align: center;
        }
        
        .summary-card.ftd {
            border-top-color: #28a745;
        }
        
        .summary-card.mtd {
            border-top-color: #17a2b8;
        }
        
        .summary-card.ytd {
            border-top-color: #ffc107;
        }
        
        .summary-card h3 {
            color: #4a6491;
            font-size: 14px;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .summary-card .value {
            font-size: 28px;
            font-weight: 700;
            color: #2c3e50;
        }
        
        .summary-card .subtext {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        
        .report-section {
            margin-bottom: 30px;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .report-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .attendance-table {
            width: 100%;
            margin-top: 20px;
        }
        
        .attendance-table th {
            background: #e9ecef;
            color: #495057;
            font-weight: 600;
            padding: 12px;
            text-align: center;
        }
        
        .attendance-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #dee2e6;
        }
        
        .present {
            background-color: #d4edda;
            color: #155724;
            font-weight: bold;
        }
        
        .absent {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .date-header {
            background: #f8f9fa;
            font-weight: bold;
            color: #495057;
        }
        
        .compressor-name {
            text-align: left;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .report-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .report-controls .btn {
            width: auto;
            padding: 10px 20px;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 14px;
            border-top: 1px solid #eee;
            margin-top: 30px;
        }
        
        @media (max-width: 992px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                flex: 0 0 auto;
                border-right: none;
                border-bottom: 1px solid #eee;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                border-radius: 0;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1;
                text-align: center;
                padding: 12px 10px;
                font-size: 14px;
            }
            
            .summary-cards {
                grid-template-columns: 1fr;
            }
            
            .attendance-table {
                font-size: 12px;
            }
            
            .attendance-table th,
            .attendance-table td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-file-invoice-dollar"></i> Compressor Payment Management System</h1>
            <p>Manage tractor drilling records, calculate payments, and generate reports</p>
        </header>
        
        <div class="tabs">
            <div class="tab active" data-tab="entry">New Bill Entry</div>
            <div class="tab" data-tab="search">Search & Reports</div>
            <div class="tab" data-tab="data">All Compressors</div>
            <div class="tab" data-tab="summary">Summary Report</div>
            <div class="tab" data-tab="attendance">Compressor Attendance</div>
        </div>
        
        <div class="main-content">
            <div class="sidebar">
                <div class="tab-content active" id="entry">
                    <h2 class="section-title"><i class="fas fa-plus-circle"></i> New Bill Entry</h2>
                    
                    <div class="form-group">
                        <label for="bill-date">Bill Date</label>
                        <input type="date" id="bill-date" value="">
                    </div>
                    
                    <div class="form-group">
                        <label for="compressor-select">Select Compressor</label>
                        <select id="compressor-select">
                            <option value="">-- Select Compressor --</option>
                            <!-- Options will be populated from data -->
                        </select>
                    </div>
                    
                    <div class="compressor-info" id="compressor-info" style="display: none;">
                        <h3 id="selected-compressor-name">Compressor Name</h3>
                        <div id="tractor-details">Tractor details will appear here</div>
                        <div id="bank-details">Bank details will appear here</div>
                    </div>
                    
                    <div class="form-group">
                        <label>Drill Size</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="size-5" name="drill-size" value="5">
                                <label for="size-5">5"</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="size-5.5" name="drill-size" value="5.5">
                                <label for="size-5.5">5.5"</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="size-both" name="drill-size" value="both" checked>
                                <label for="size-both">Both</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="holes">Total Holes</label>
                        <input type="number" id="holes" min="0" step="1" placeholder="Enter number of holes">
                    </div>
                    
                    <div class="form-group">
                        <label for="feet">Total Feet</label>
                        <input type="number" id="feet" min="0" step="0.01" placeholder="Enter total feet">
                    </div>
                    
                    <div class="form-group">
                        <label for="rate">Rate per Foot (₹)</label>
                        <input type="number" id="rate" value="30.75" step="0.01" readonly>
                    </div>
                    
                    <div class="bill-details">
                        <div class="bill-row">
                            <span class="bill-label">Total Amount:</span>
                            <span class="bill-value" id="total-amount">₹ 0.00</span>
                        </div>
                    </div>
                    
                    <button class="btn btn-success" id="save-bill">
                        <i class="fas fa-save"></i> Save Bill
                    </button>
                    
                    <button class="btn btn-secondary" id="clear-form">
                        <i class="fas fa-eraser"></i> Clear Form
                    </button>
                </div>
                
                <div class="tab-content" id="search">
                    <h2 class="section-title"><i class="fas fa-search"></i> Search Bills</h2>
                    
                    <div class="form-group">
                        <label for="search-compressor-select">Select Compressor</label>
                        <select id="search-compressor-select">
                            <option value="">-- Select Compressor --</option>
                            <!-- Options will be populated from data -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="search-date">Filter by Date (Optional)</label>
                        <input type="date" id="search-date">
                    </div>
                    
                    <button class="btn btn-info" id="apply-filter">
                        <i class="fas fa-filter"></i> Apply Filter
                    </button>
                    
                    <button class="btn btn-secondary" id="clear-filter">
                        <i class="fas fa-times"></i> Clear Filter
                    </button>
                    
                    <div id="search-results" style="margin-top: 20px;">
                        <!-- Search results will appear here -->
                        <div class="empty-state">
                            <i class="fas fa-search"></i>
                            <h3>Search for compressor bills</h3>
                            <p>Select a compressor to view bill details</p>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="data">
                    <h2 class="section-title"><i class="fas fa-database"></i> All Compressors</h2>
                    <p>List of all registered compressors with their details.</p>
                    
                    <div id="all-compressors-list">
                        <!-- Compressor list will appear here -->
                    </div>
                </div>
                
                <div class="tab-content" id="summary">
                    <h2 class="section-title"><i class="fas fa-chart-pie"></i> Summary Report</h2>
                    <p>Complete summary of all compressor bills.</p>
                    
                    <div class="summary-cards" id="summary-cards">
                        <!-- Summary cards will appear here -->
                    </div>
                    
                    <button class="btn btn-success" id="download-summary">
                        <i class="fas fa-file-pdf"></i> Download Summary PDF
                    </button>
                    
                    <button class="btn btn-info" id="refresh-summary">
                        <i class="fas fa-sync-alt"></i> Refresh Summary
                    </button>
                </div>
                
                <div class="tab-content" id="attendance">
                    <h2 class="section-title"><i class="fas fa-calendar-check"></i> Attendance Settings</h2>
                    
                    <div class="form-group">
                        <label for="attendance-month">Select Month</label>
                        <input type="month" id="attendance-month" value="">
                    </div>
                    
                    <div class="form-group">
                        <label>Working Days in Month</label>
                        <input type="number" id="working-days" min="1" max="31" value="26" placeholder="Working days">
                    </div>
                    
                    <button class="btn btn-info" id="generate-attendance">
                        <i class="fas fa-calendar-alt"></i> Generate Attendance
                    </button>
                    
                    <button class="btn btn-success" id="save-attendance">
                        <i class="fas fa-save"></i> Save Attendance
                    </button>
                    
                    <div class="compressor-info" style="margin-top: 20px;">
                        <h3>Attendance Legend</h3>
                        <p><span class="present" style="padding: 2px 5px;">Present</span> - Compressor worked that day</p>
                        <p><span class="absent" style="padding: 2px 5px;">Absent</span> - No work recorded</p>
                    </div>
                </div>
            </div>
            
            <div class="content-area">
                <div id="main-content-area">
                    <div class="empty-state">
                        <i class="fas fa-file-alt"></i>
                        <h3>No Data Selected</h3>
                        <p>Select a compressor or search for bills to view details here</p>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Compressor Payment Management System &copy; 2025 | Data is stored locally in your browser</p>
        </footer>
    </div>

    <script>
        // Compressor data from the provided table
        const compressorData = [
            {
                id: 1,
                name: "ALLAM VASU",
                tractors: ["AP39CA2814"],
                bankAccount: "40988132071",
                ifsc: "SBIN0000805",
                pan: "CVOPV6966K",
                bills: [],
                attendance: {}
            },
            {
                id: 2,
                name: "POLINATI VENKATA SRINIVASA RAO",
                tractors: ["AP35 V 5237", "AP07AG 6505"],
                bankAccount: "6086101003124",
                ifsc: "CNRB0006086",
                pan: "ENNPP6015C",
                bills: [],
                attendance: {}
            },
            {
                id: 3,
                name: "KARANAM SRINIVASA RAO",
                tractors: ["AP27CD 2762"],
                bankAccount: "110150266393",
                ifsc: "CNRB0006086",
                pan: "BSEPR6431D",
                bills: [],
                attendance: {}
            },
            {
                id: 4,
                name: "JOMMALA SIVA",
                tractors: ["AP31TT3215", "AP33 CD4892"],
                bankAccount: "3249509013",
                ifsc: "KKBK0007812",
                pan: "BBWPJ8852M",
                bills: [],
                attendance: {}
            },
            {
                id: 5,
                name: "L. ARUN KUMAR",
                tractors: ["AP31 DM 4375"],
                bankAccount: "053501508399",
                ifsc: "ICIC0000535",
                pan: "ANIPL8768P",
                bills: [],
                attendance: {}
            },
            {
                id: 6,
                name: "GADI LAXMI",
                tractors: ["AP27CA 1788"],
                bankAccount: "36953130643",
                ifsc: "SBIN0000805",
                pan: "BVOPL7103H",
                bills: [],
                attendance: {}
            },
            {
                id: 7,
                name: "SRINU SREERAMSETTY",
                tractors: ["AP31DM9316"],
                bankAccount: "34991974405",
                ifsc: "SBIN0000805",
                pan: "JDCPS7095R",
                bills: [],
                attendance: {}
            },
            {
                id: 8,
                name: "B.SAMUDRU RAJU",
                tractors: ["AP39CV1559"],
                bankAccount: "971004023",
                ifsc: "IDIB000A020",
                pan: "CGJPB2625R",
                bills: [],
                attendance: {}
            },
            {
                id: 9,
                name: "KARANAM ANAND (K.ANAND)",
                tractors: ["AP39W2632"],
                bankAccount: "039301000040901",
                ifsc: "IOBA0000393",
                pan: "FVGPK7302M",
                bills: [],
                attendance: {}
            },
            {
                id: 10,
                name: "PEDDI SETTY TRIMURTHULU",
                tractors: ["AP31EH 5415"],
                bankAccount: "8038481228",
                ifsc: "IDIB000A020",
                pan: "EBLPP9933F",
                bills: [],
                attendance: {}
            },
            {
                id: 11,
                name: "NEETIPALLI APPARAO",
                tractors: ["AP39TT 1202"],
                bankAccount: "34675754049",
                ifsc: "SBIN0006338",
                pan: "BKEPN3783Q",
                bills: [],
                attendance: {}
            },
            {
                id: 12,
                name: "KATA NOOKARAJU",
                tractors: ["AP39U 6311"],
                bankAccount: "20304516192",
                ifsc: "SBIN0000805",
                pan: "CGJPK1884R",
                bills: [],
                attendance: {}
            },
            {
                id: 13,
 name: "SANYASI NAIDU",
                tractors: ["AP26 BR 4476"],
                bankAccount: "34443923670",
                ifsc: "SBIN0000805",
                pan: "CMSPN8453Q",
                bills: [],
                attendance: {}
            },
            {
                id: 14,
                name: "NAMBARU SRINIVASA RAO",
                tractors: ["AP27BS 8679"],
                bankAccount: "34002808173",
                ifsc: "SBIN0000805",
                pan: "AYGPN8019G",
                bills: [],
                attendance: {}
            },
            {
                id: 15,
                name: "LANKA SRINIVASARAO",
                tractors: ["AP31EQ 5430"],
                bankAccount: "20304515950",
                ifsc: "SBIN0000805",
                pan: "ANDPL4664M",
                bills: [],
                attendance: {}
            },
            {
                id: 16,
                name: "NAGULAPALLI KRISHNA",
                tractors: ["AP31DM 4362"],
                bankAccount: "32379988581",
                ifsc: "SBIN0000805",
                pan: "AVYPN2276N",
                bills: [],
                attendance: {}
            },
            {
                id: 17,
                name: "GADASALA .VENKATARAO",
                tractors: ["AP31AV2679"],
                bankAccount: "33967733911",
                ifsc: "SBIN0000805",
                pan: "BTMPG1103L",
                bills: [],
                attendance: {}
            },
            {
                id: 18,
                name: "NAMBARU VENKATAPPARAO (VEERU NAIDU)",
                tractors: ["0P31EL 0779"],
                bankAccount: "33883632995",
                ifsc: "SBIN0000805",
                pan: "BKEPN3783Q",
                bills: [],
                attendance: {}
            },
            {
                id: 19,
                name: "CHAPPAGADDA SIVA SAI SANKAR (MPTC MATURU)",
                tractors: ["TS26 T4510"],
                bankAccount: "039302000002032",
                ifsc: "IOBA0000393",
                pan: "BKWPC2193P",
                bills: [],
                attendance: {}
            },
            {
                id: 20,
                name: "RAVI MAHALAXMI DORA",
                tractors: ["AP39 TJ1024"],
                bankAccount: "063110100168824",
                ifsc: "UBIN0806315",
                pan: "CEAPR2044K",
                bills: [],
                attendance: {}
            },
            {
                id: 21,
                name: "SATYANNARANA",
                tractors: ["AP27UB 6303"],
                bankAccount: "30483532930",
                ifsc: "SBIN000805",
                pan: "DPIPS5590M",
                bills: [],
                attendance: {}
            },
            {
                id: 22,
                name: "TARRA APPALARAJU",
                tractors: ["AP31 EN 5794"],
                bankAccount: "50100134897074",
                ifsc: "HDFC0001032",
                pan: "ALVPT7398A",
                bills: [],
                attendance: {}
            },
            {
                id: 23,
                name: "GADASALA SURIBABU",
                tractors: ["AP26 TF 5271"],
                bankAccount: "039302000002030",
                ifsc: "IOBA0000393",
                pan: "QGLPS2039Q",
                bills: [],
                attendance: {}
            },
            {
                id: 24,
                name: "PEDISETTI BABOJI",
                tractors: ["AP27BS 6692"],
                bankAccount: "4145340205",
                ifsc: "KKBK0007812",
                pan: "FLHPB5792K",
                bills: [],
                attendance: {}
            },
            {
                id: 25,
                name: "GADI PADMA W/O LAXMANA RAO",
                tractors: ["AP31TT 2085"],
                bankAccount: "41074777076",
                ifsc: "SBIN0000805",
                pan: "CYDPG3473L",
                bills: [],
                attendance: {}
            },
            {
                id: 26,
                name: "YELAMALA SIVAJI",
                tractors: ["AP31CB2759"],
                bankAccount: "1004005003528",
                ifsc: "IBKL0150KMC",
                pan: "AKOPY6857B",
                bills: [],
                attendance: {}
            },
            {
                id: 27,
                name: "GURRAM KRISHNARAO",
                tractors: ["AP39 A 4504"],
                bankAccount: "50100418811812",
                ifsc: "HDFC0001032",
                pan: "CNTPG6055P",
                bills: [],
                attendance: {}
            },
            {
                id: 28,
                name: "ISARAPU SURYANARAYANA",
                tractors: ["AP31TB 9631"],
                bankAccount: "6086101006038",
                ifsc: "CNRB0006086",
                pan: "AHQP17955M",
                bills: [],
                attendance: {}
            },
            {
                id: 29,
                name: "KUMARI BALLA (P ANAND)",
                tractors: ["AP39DZ 8233", "AP07 TJ 1293"],
                bankAccount: "386602010016453",
                ifsc: "UBIN0538663",
                pan: "DWYPB31OOD",
                bills: [],
                attendance: {}
            },
            {
                id: 30,
                name: "ALLAM VENKATA SIVAJEE",
                tractors: ["AP39T1609"],
                bankAccount: "42081135431",
                ifsc: "SBIN0000805",
                pan: "RLJPS1208H",
                bills: [],
                attendance: {}
            },
            {
                id: 31,
                name: "RAAVI SARVALAKSHMI W/O RAVI RAMESH",
                tractors: ["APAP39RN9933"],
                bankAccount: "063112010002232",
                ifsc: "UBIN0806315",
                pan: "QNZPS1493F",
                bills: [],
                attendance: {}
            },
            {
                id: 32,
                name: "SOMSESWARA ROA VASADI V.SHOMNAIDU (ADAPA SRINU)",
                tractors: ["AP39LT0311"],
                bankAccount: "96011524622",
                ifsc: "COAS0000001",
                pan: "EZTPR2341H",
                bills: [],
                attendance: {}
            },
            {
                id: 33,
                name: "SESHAPU SREELATHA (VINAY) W/O RAMBABU LATE",
                tractors: ["AP35T80821"],
                bankAccount: "33209179511",
                ifsc: "SBIN0000805",
                pan: "LUGPS3440D",
                bills: [],
                attendance: {}
            },
            {
                id: 34,
                name: "JAGARAPU RAMANA",
                tractors: [],
                bankAccount: "20216163869",
                ifsc: "SBIN0015388",
                pan: "ASZPJ0977E",
                bills: [],
                attendance: {}
            },
            {
                id: 35,
                name: "KARANAM MAHESWARI (HANUMANTHARAO)",
                tractors: [],
                bankAccount: "1.1012E+11",
                ifsc: "CNRB0002609",
                pan: "IILPM9924G",
                bills: [],
                attendance: {}
            },
            {
                id: 36,
                name: "KARANAM KRISHNA (MAHESH)",
                tractors: ["AP39AD 2185"],
                bankAccount: "1003104000148191",
                ifsc: "IBKL0001003",
                pan: "MQVPK7059L",
                bills: [],
                attendance: {}
            },
            {
                id: 37,
                name: "OMMI MODI BABU",
                tractors: [],
                bankAccount: "6086101003133",
                ifsc: "CNRB0006086",
                pan: "ABEP01294K",
                bills: [],
                attendance: {}
            }
        ];

        // Application state
        const appState = {
            currentCompressor: null,
            currentBill: null,
            allBills: [],
            currentMonthAttendance: null
        };

        // DOM Elements
        const compressorSelect = document.getElementById('compressor-select');
        const compressorInfo = document.getElementById('compressor-info');
        const selectedCompressorName = document.getElementById('selected-compressor-name');
        const tractorDetails = document.getElementById('tractor-details');
        const bankDetails = document.getElementById('bank-details');
        const holesInput = document.getElementById('holes');
        const feetInput = document.getElementById('feet');
        const rateInput = document.getElementById('rate');
        const totalAmountElement = document.getElementById('total-amount');
        const saveBillBtn = document.getElementById('save-bill');
        const clearFormBtn = document.getElementById('clear-form');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const searchCompressorSelect = document.getElementById('search-compressor-select');
        const searchDateInput = document.getElementById('search-date');
        const applyFilterBtn = document.getElementById('apply-filter');
        const clearFilterBtn = document.getElementById('clear-filter');
        const searchResults = document.getElementById('search-results');
        const allCompressorsList = document.getElementById('all-compressors-list');
        const mainContentArea = document.getElementById('main-content-area');
        const summaryCards = document.getElementById('summary-cards');
        const downloadSummaryBtn = document.getElementById('download-summary');
        const refreshSummaryBtn = document.getElementById('refresh-summary');
        const billDateInput = document.getElementById('bill-date');
        const attendanceMonthInput = document.getElementById('attendance-month');
        const workingDaysInput = document.getElementById('working-days');
        const generateAttendanceBtn = document.getElementById('generate-attendance');
        const saveAttendanceBtn = document.getElementById('save-attendance');

        // Initialize the app
        function initApp() {
            // Set default date to today
            const today = new Date().toISOString().split('T')[0];
            billDateInput.value = today;
            
            // Set default attendance month to current month
            const currentMonth = new Date().toISOString().slice(0, 7);
            attendanceMonthInput.value = currentMonth;
            
            loadDataFromStorage();
            populateCompressorSelects();
            displayAllCompressors();
            updateSummary();
            setupEventListeners();
            calculateTotal();
        }

        // Load data from local storage
        function loadDataFromStorage() {
            const storedData = localStorage.getItem('compressorBills');
            if (storedData) {
                const parsedData = JSON.parse(storedData);
                parsedData.forEach((storedCompressor, index) => {
                    if (compressorData[index]) {
                        compressorData[index].bills = storedCompressor.bills || [];
                        compressorData[index].attendance = storedCompressor.attendance || {};
                    }
                });
                
                // Update app state
                appState.allBills = getAllBills();
            }
        }

        // Save data to local storage
        function saveDataToStorage() {
            const dataToSave = compressorData.map(compressor => ({
                id: compressor.id,
                bills: compressor.bills,
                attendance: compressor.attendance
            }));
            localStorage.setItem('compressorBills', JSON.stringify(dataToSave));
            appState.allBills = getAllBills();
            updateSummary();
        }

        // Get all bills from all compressors
        function getAllBills() {
            let allBills = [];
            compressorData.forEach(compressor => {
                compressor.bills.forEach(bill => {
                    allBills.push({
                        ...bill,
                        compressorName: compressor.name,
                        compressorId: compressor.id
                    });
                });
            });
            return allBills;
        }

        // Get FTD (Financial Year To Date) bills - April 1 to current date
        function getFTDBills() {
            const currentDate = new Date();
            const currentYear = currentDate.getFullYear();
            const currentMonth = currentDate.getMonth() + 1;
            
            // Financial year starts from April 1
            let financialYearStart;
            if (currentMonth >= 4) {
                financialYearStart = `${currentYear}-04-01`;
            } else {
                financialYearStart = `${currentYear - 1}-04-01`;
            }
            
            return appState.allBills.filter(bill => {
                return bill.date >= financialYearStart && bill.date <= currentDate.toISOString().split('T')[0];
            });
        }

        // Get MTD (Month To Date) bills
        function getMTDBills() {
            const currentDate = new Date();
            const year = currentDate.getFullYear();
            const month = String(currentDate.getMonth() + 1).padStart(2, '0');
            const monthStart = `${year}-${month}-01`;
            
            return appState.allBills.filter(bill => {
                return bill.date >= monthStart && bill.date <= currentDate.toISOString().split('T')[0];
            });
        }

        // Get YTD (Year To Date) bills
        function getYTDBills() {
            const currentDate = new Date();
            const yearStart = `${currentDate.getFullYear()}-01-01`;
            
            return appState.allBills.filter(bill => {
                return bill.date >= yearStart && bill.date <= currentDate.toISOString().split('T')[0];
            });
        }

        // Populate compressor selects
        function populateCompressorSelects() {
            // Clear existing options
            compressorSelect.innerHTML = '<option value="">-- Select Compressor --</option>';
            searchCompressorSelect.innerHTML = '<option value="">-- Select Compressor --</option>';
            
            // Add options
            compressorData.forEach(compressor => {
                const option = document.createElement('option');
                option.value = compressor.id;
                option.textContent = compressor.name;
                compressorSelect.appendChild(option.cloneNode(true));
                searchCompressorSelect.appendChild(option);
            });
        }

        // Display all compressors in the data tab
        function displayAllCompressors() {
            allCompressorsList.innerHTML = '';
            
            compressorData.forEach(compressor => {
                const compressorCard = document.createElement('div');
                compressorCard.className = 'compressor-info';
                compressorCard.innerHTML = `
                    <h3>${compressor.name}</h3>
                    <p><strong>Tractors:</strong> ${compressor.tractors.length > 0 ? compressor.tractors.join(', ') : 'Not specified'}</p>
                    <p><strong>Bank Account:</strong> ${compressor.bankAccount}</p>
                    <p><strong>IFSC:</strong> ${compressor.ifsc}</p>
                    <p><strong>PAN:</strong> ${compressor.pan}</p>
                    <p><strong>Total Bills:</strong> ${compressor.bills.length}</p>
                    <button class="btn btn-secondary view-compressor-btn" data-id="${compressor.id}">
                        <i class="fas fa-eye"></i> View Bills
                    </button>
                `;
                allCompressorsList.appendChild(compressorCard);
            });
            
            // Add event listeners to view buttons
            document.querySelectorAll('.view-compressor-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const compressorId = parseInt(this.getAttribute('data-id'));
                    const compressor = compressorData.find(c => c.id === compressorId);
                    if (compressor) {
                        showCompressorBills(compressor);
                        // Switch to search tab
                        document.querySelector('.tab[data-tab="search"]').click();
                        searchCompressorSelect.value = compressorId;
                    }
                });
            });
        }

        // Update summary report with enhanced cards
        function updateSummary() {
            const allBills = getAllBills();
            const ftdBills = getFTDBills();
            const mtdBills = getMTDBills();
            const ytdBills = getYTDBills();
            
            // Calculate totals
            let totalCompressors = compressorData.length;
            let totalBills = allBills.length;
            let totalHoles = 0;
            let totalFeet = 0;
            let totalAmount = 0;
            
            allBills.forEach(bill => {
                totalHoles += bill.holes;
                totalFeet += bill.feet;
                totalAmount += bill.totalAmount;
            });
            
            // Calculate FTD totals
            let ftdHoles = 0;
            let ftdFeet = 0;
            let ftdAmount = 0;
            ftdBills.forEach(bill => {
                ftdHoles += bill.holes;
                ftdFeet += bill.feet;
                ftdAmount += bill.totalAmount;
            });
            
            // Calculate MTD totals
            let mtdHoles = 0;
            let mtdFeet = 0;
            let mtdAmount = 0;
            mtdBills.forEach(bill => {
                mtdHoles += bill.holes;
                mtdFeet += bill.feet;
                mtdAmount += bill.totalAmount;
            });
            
            // Calculate YTD totals
            let ytdHoles = 0;
            let ytdFeet = 0;
            let ytdAmount = 0;
            ytdBills.forEach(bill => {
                ytdHoles += bill.holes;
                ytdFeet += bill.feet;
                ytdAmount += bill.totalAmount;
            });
            
            // Update summary cards
            summaryCards.innerHTML = `
                <div class="summary-card">
                    <h3>Total Compressors</h3>
                    <div class="value">${totalCompressors}</div>
                    <div class="subtext">Registered compressors</div>
                </div>
                <div class="summary-card">
                    <h3>Total Bills</h3>
                    <div class="value">${totalBills}</div>
                    <div class="subtext">All bill entries</div>
                </div>
                <div class="summary-card">
                    <h3>Total Feet</h3>
                    <div class="value">${totalFeet.toFixed(2)}</div>
                    <div class="subtext">All feet drilled</div>
                </div>
                <div class="summary-card">
                    <h3>Total Cost</h3>
                    <div class="value">₹${totalAmount.toFixed(2)}</div>
                    <div class="subtext">Total payment amount</div>
                </div>
                <div class="summary-card ftd">
                    <h3>FTD Amount</h3>
                    <div class="value">₹${ftdAmount.toFixed(2)}</div>
                    <div class="subtext">Financial Year To Date</div>
                </div>
                <div class="summary-card mtd">
                    <h3>MTD Amount</h3>
                    <div class="value">₹${mtdAmount.toFixed(2)}</div>
                    <div class="subtext">Month To Date</div>
                </div>
                <div class="summary-card ytd">
                    <h3>YTD Amount</h3>
                    <div class="value">₹${ytdAmount.toFixed(2)}</div>
                    <div class="subtext">Year To Date</div>
                </div>
                <div class="summary-card">
                    <h3>Avg Rate/Foot</h3>
                    <div class="value">₹${totalFeet > 0 ? (totalAmount/totalFeet).toFixed(2) : '0.00'}</div>
                    <div class="subtext">Average rate per foot</div>
                </div>
            `;
        }

        // Setup event listeners
        function setupEventListeners() {
            // Tab switching
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Update active tab
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show corresponding content
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === tabId) {
                            content.classList.add('active');
                        }
                    });
                    
                    // Clear main content area when switching to entry tab
                    if (tabId === 'entry') {
                        mainContentArea.innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-file-alt"></i>
                                <h3>No Data Selected</h3>
                                <p>Select a compressor or search for bills to view details here</p>
                            </div>
                        `;
                    } else if (tabId === 'summary') {
                        updateSummary();
                    } else if (tabId === 'attendance') {
                        generateAttendanceReport();
                    }
                });
            });
            
            // Compressor selection
            compressorSelect.addEventListener('change', function() {
                const compressorId = parseInt(this.value);
                if (compressorId) {
                    const compressor = compressorData.find(c => c.id === compressorId);
                    if (compressor) {
                        appState.currentCompressor = compressor;
                        updateCompressorInfo(compressor);
                        compressorInfo.style.display = 'block';
                    }
                } else {
                    compressorInfo.style.display = 'none';
                    appState.currentCompressor = null;
                }
            });
            
            // Calculate total when holes or feet change
            holesInput.addEventListener('input', calculateTotal);
            feetInput.addEventListener('input', calculateTotal);
            
            // Save bill
            saveBillBtn.addEventListener('click', saveBill);
            
            // Clear form
            clearFormBtn.addEventListener('click', clearForm);
            
            // Apply filter in search
            applyFilterBtn.addEventListener('click', performSearch);
            
            // Clear filter in search
            clearFilterBtn.addEventListener('click', clearSearchFilter);
            
            // Search compressor select
            searchCompressorSelect.addEventListener('change', performSearch);
            
            // Summary tab buttons
            downloadSummaryBtn.addEventListener('click', downloadSummaryPDF);
            refreshSummaryBtn.addEventListener('click', updateSummary);
            
            // Attendance buttons
            generateAttendanceBtn.addEventListener('click', generateAttendanceReport);
            saveAttendanceBtn.addEventListener('click', saveAttendanceData);
        }

        // Update compressor info display
        function updateCompressorInfo(compressor) {
            selectedCompressorName.textContent = compressor.name;
            
            // Tractor details
            let tractorHTML = '<p><strong>Tractors:</strong></p><ul>';
            compressor.tractors.forEach(tractor => {
                tractorHTML += `<li>${tractor}</li>`;
            });
            tractorHTML += '</ul>';
            tractorDetails.innerHTML = tractorHTML;
            
            // Bank details
            bankDetails.innerHTML = `
                <p><strong>Bank Account:</strong> ${compressor.bankAccount}</p>
                <p><strong>IFSC Code:</strong> ${compressor.ifsc}</p>
                <p><strong>PAN Card:</strong> ${compressor.pan}</p>
            `;
        }

        // Calculate total amount
        function calculateTotal() {
            const holes = parseFloat(holesInput.value) || 0;
            const feet = parseFloat(feetInput.value) || 0;
            const rate = parseFloat(rateInput.value) || 30.75;
            
            // Calculate based on drill size selection
            const drillSize = document.querySelector('input[name="drill-size"]:checked').value;
            let total = 0;
            
            if (drillSize === 'both') {
                total = feet * rate;
            } else {
                // For single size, we could have different rates if needed
                total = feet * rate;
            }
            
            totalAmountElement.textContent = `₹ ${total.toFixed(2)}`;
        }

        // Save bill to compressor
        function saveBill() {
            // Validation
            if (!appState.currentCompressor) {
                alert('Please select a compressor first');
                return;
            }
            
            const billDate = billDateInput.value;
            if (!billDate) {
                alert('Please select a bill date');
                billDateInput.focus();
                return;
            }
            
            const holes = parseInt(holesInput.value);
            const feet = parseFloat(feetInput.value);
            const drillSize = document.querySelector('input[name="drill-size"]:checked').value;
            
            if (!holes || holes <= 0) {
                alert('Please enter a valid number of holes');
                holesInput.focus();
                return;
            }
            
            if (!feet || feet <= 0) {
                alert('Please enter a valid total feet');
                feetInput.focus();
                return;
            }
            
            const rate = parseFloat(rateInput.value);
            const totalAmount = feet * rate;
            
            // Create bill object
            const bill = {
                id: Date.now(),
                date: billDate,
                formattedDate: formatDate(billDate),
                drillSize: drillSize,
                holes: holes,
                feet: feet,
                rate: rate,
                totalAmount: totalAmount
            };
            
            // Add bill to compressor
            appState.currentCompressor.bills.push(bill);
            
            // Update attendance for this compressor
            updateCompressorAttendance(appState.currentCompressor.id, billDate);
            
            // Save to local storage
            saveDataToStorage();
            
            // Show success message
            alert(`Bill saved successfully for ${appState.currentCompressor.name}\nTotal Amount: ₹${totalAmount.toFixed(2)}`);
            
            // Show the bill in main content area
            showBillDetails(bill, appState.currentCompressor);
            
            // Clear form
            clearForm();
        }

        // Update compressor attendance based on bill date
        function updateCompressorAttendance(compressorId, billDate) {
            const compressor = compressorData.find(c => c.id === compressorId);
            if (!compressor) return;
            
            const yearMonth = billDate.substring(0, 7); // YYYY-MM
            const day = parseInt(billDate.substring(8, 10));
            
            if (!compressor.attendance[yearMonth]) {
                compressor.attendance[yearMonth] = {};
            }
            
            // Mark as present for this day
            compressor.attendance[yearMonth][day] = true;
        }

        // Format date from YYYY-MM-DD to DD/MM/YYYY
        function formatDate(dateString) {
            const date = new Date(dateString);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        // Generate attendance report
        function generateAttendanceReport() {
            const monthValue = attendanceMonthInput.value;
            if (!monthValue) {
                alert('Please select a month first');
                return;
            }
            
            const year = parseInt(monthValue.substring(0, 4));
            const month = parseInt(monthValue.substring(5, 7));
            const daysInMonth = new Date(year, month, 0).getDate();
            const workingDays = parseInt(workingDaysInput.value) || daysInMonth;
            
            // Create attendance data
            const attendanceData = compressorData.map(compressor => {
                const monthAttendance = compressor.attendance[monthValue] || {};
                const days = [];
                
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const hasBill = compressor.bills.some(bill => bill.date === dateStr);
                    days.push({
                        day: day,
                        present: hasBill || monthAttendance[day] === true
                    });
                }
                
                return {
                    name: compressor.name,
                    days: days,
                    totalPresent: days.filter(d => d.present).length
                };
            });
            
            // Display attendance report
            displayAttendanceReport(attendanceData, year, month, daysInMonth, workingDays);
        }

        // Display attendance report in main content area
        function displayAttendanceReport(attendanceData, year, month, daysInMonth, workingDays) {
            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"];
            
            let reportHTML = `
                <div class="report-section">
                    <h2><i class="fas fa-calendar-alt"></i> Compressor Attendance Report</h2>
                    <p><strong>Month:</strong> ${monthNames[month-1]} ${year}</p>
                    <p><strong>Total Days:</strong> ${daysInMonth} | <strong>Working Days:</strong> ${workingDays}</p>
                    
                    <div class="report-controls">
                        <button class="btn btn-success" onclick="downloadAttendancePDF()">
                            <i class="fas fa-file-pdf"></i> Download PDF
                        </button>
                        <button class="btn btn-info" onclick="generateAttendanceReport()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                </div>
                
                <div class="report-section">
                    <h3>Attendance Summary</h3>
                    <div class="summary-cards">
            `;
            
            // Calculate summary statistics
            const totalPresentDays = attendanceData.reduce((sum, compressor) => sum + compressor.totalPresent, 0);
            const avgAttendance = attendanceData.length > 0 ? (totalPresentDays / attendanceData.length).toFixed(1) : 0;
            const attendanceRate = (totalPresentDays / (attendanceData.length * workingDays) * 100).toFixed(1);
            
            reportHTML += `
                <div class="summary-card">
                    <h3>Total Compressors</h3>
                    <div class="value">${attendanceData.length}</div>
                    <div class="subtext">Active compressors</div>
                </div>
                <div class="summary-card">
                    <h3>Total Present Days</h3>
                    <div class="value">${totalPresentDays}</div>
                    <div class="subtext">All working days</div>
                </div>
                <div class="summary-card">
                    <h3>Avg Attendance</h3>
                    <div class="value">${avgAttendance}</div>
                    <div class="subtext">Days per compressor</div>
                </div>
                <div class="summary-card">
                    <h3>Attendance Rate</h3>
                    <div class="value">${attendanceRate}%</div>
                    <div class="subtext">Overall attendance</div>
                </div>
                    </div>
                </div>
                
                <div class="report-section">
                    <h3>Daily Attendance Details</h3>
                    <div style="overflow-x: auto;">
                        <table class="attendance-table">
                            <thead>
                                <tr>
                                    <th rowspan="2">Compressor Name</th>
                                    <th colspan="${daysInMonth}">Days of Month</th>
                                    <th rowspan="2">Total<br>Present</th>
                                    <th rowspan="2">Attendance<br>Rate</th>
                                </tr>
                                <tr>
            `;
            
            // Add day headers
            for (let day = 1; day <= daysInMonth; day++) {
                reportHTML += `<th class="date-header">${day}</th>`;
            }
            
            reportHTML += `
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            // Add compressor rows
            attendanceData.forEach(compressor => {
                reportHTML += `<tr>
                    <td class="compressor-name">${compressor.name}</td>`;
                
                // Add day cells
                compressor.days.forEach(day => {
                    reportHTML += `<td class="${day.present ? 'present' : 'absent'}">${day.present ? 'P' : ''}</td>`;
                });
                
                // Add totals
                const attendanceRate = workingDays > 0 ? Math.round((compressor.totalPresent / workingDays) * 100) : 0;
                reportHTML += `
                    <td><strong>${compressor.totalPresent}</strong></td>
                    <td><strong>${attendanceRate}%</strong></td>
                </tr>`;
            });
            
            // Add footer row
            reportHTML += `<tr>
                <td class="compressor-name"><strong>TOTAL/AVG</strong></td>`;
            
            for (let day = 1; day <= daysInMonth; day++) {
                const presentCount = attendanceData.filter(compressor => compressor.days[day-1].present).length;
                reportHTML += `<td class="date-header"><strong>${presentCount}</strong></td>`;
            }
            
            const avgPresent = (totalPresentDays / attendanceData.length).toFixed(1);
            reportHTML += `
                <td><strong>${avgPresent}</strong></td>
                <td><strong>${attendanceRate}%</strong></td>
            </tr>`;
            
            reportHTML += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            mainContentArea.innerHTML = reportHTML;
            
            // Store current attendance data for PDF export
            appState.currentMonthAttendance = {
                data: attendanceData,
                year: year,
                month: month,
                monthName: monthNames[month-1],
                daysInMonth: daysInMonth,
                workingDays: workingDays
            };
        }

        // Save attendance data
        function saveAttendanceData() {
            const monthValue = attendanceMonthInput.value;
            if (!monthValue) {
                alert('Please select a month first');
                return;
            }
            
            // Attendance is already saved when bills are added
            saveDataToStorage();
            alert('Attendance data saved successfully!');
        }

        // Show bill details in main content area
        function showBillDetails(bill, compressor) {
            mainContentArea.innerHTML = `
                <div class="bill-details">
                    <h2 class="section-title"><i class="fas fa-receipt"></i> Bill Details</h2>
                    
                    <div class="compressor-info">
                        <h3>${compressor.name}</h3>
                        <p><strong>Tractors:</strong> ${compressor.tractors.length > 0 ? compressor.tractors.join(', ') : 'Not specified'}</p>
                    </div>
                    
                    <div class="bill-row">
                        <span class="bill-label">Bill Date:</span>
                        <span class="bill-value">${bill.formattedDate}</span>
                    </div>
                    
                    <div class="bill-row">
                        <span class="bill-label">Drill Size:</span>
                        <span class="bill-value">${bill.drillSize === 'both' ? 'Both 5" & 5.5"' : bill.drillSize + '"'}</span>
                    </div>
                    
                    <div class="bill-row">
                        <span class="bill-label">Number of Holes:</span>
                        <span class="bill-value">${bill.holes}</span>
                    </div>
                    
                    <div class="bill-row">
                        <span class="bill-label">Total Feet:</span>
                        <span class="bill-value">${bill.feet.toFixed(2)} ft</span>
                    </div>
                    
                    <div class="bill-row">
                        <span class="bill-label">Rate per Foot:</span>
                        <span class="bill-value">₹ ${bill.rate.toFixed(2)}</span>
                    </div>
                    
                    <div class="bill-row total-row">
                        <span class="bill-label">Total Amount:</span>
                        <span class="bill-value">₹ ${bill.totalAmount.toFixed(2)}</span>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn btn-secondary" id="print-bill">
                            <i class="fas fa-print"></i> Print Bill
                        </button>
                        <button class="btn btn-success" id="download-pdf">
                            <i class="fas fa-file-pdf"></i> Download PDF
                        </button>
                    </div>
                </div>
            `;
            
            // Add event listeners for buttons
            document.getElementById('print-bill').addEventListener('click', () => window.print());
            document.getElementById('download-pdf').addEventListener('click', () => downloadBillAsPDF(bill, compressor));
        }

        // Show all bills for a compressor
        function showCompressorBills(compressor) {
            const filterDate = searchDateInput.value;
            
            // Filter bills by date if date is selected
            let filteredBills = compressor.bills;
            if (filterDate) {
                filteredBills = compressor.bills.filter(bill => bill.date === filterDate);
            }
            
            if (!filteredBills || filteredBills.length === 0) {
                const message = filterDate 
                    ? `No bills found for ${compressor.name} on ${formatDate(filterDate)}`
                    : `No bills found for ${compressor.name} yet.`;
                
                searchResults.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-file-invoice"></i>
                        <h3>No Bills Found</h3>
                        <p>${message}</p>
                    </div>
                `;
                
                mainContentArea.innerHTML = `
                    <div class="compressor-info">
                        <h3>${compressor.name}</h3>
                        <p><strong>Tractors:</strong> ${compressor.tractors.length > 0 ? compressor.tractors.join(', ') : 'Not specified'}</p>
                        <p><strong>Bank Account:</strong> ${compressor.bankAccount}</p>
                        <p><strong>IFSC:</strong> ${compressor.ifsc}</p>
                        <p><strong>PAN:</strong> ${compressor.pan}</p>
                        <p><strong>Total Bills:</strong> ${compressor.bills.length}</p>
                        ${filterDate ? `<p><strong>Filtered Date:</strong> ${formatDate(filterDate)}</p>` : ''}
                    </div>
                `;
                return;
            }
            
            // Display in search results
            let billsHTML = `
                <h3 style="margin-bottom: 15px;">${compressor.name} - Bills (${filteredBills.length})</h3>
                ${filterDate ? `<p style="margin-bottom: 10px; color: #666;">Filtered by date: ${formatDate(filterDate)}</p>` : ''}
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Drill Size</th>
                            <th>Holes</th>
                            <th>Feet</th>
                            <th>Amount</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            let totalHoles = 0;
            let totalFeet = 0;
            let totalAmount = 0;
            
            filteredBills.forEach(bill => {
                totalHoles += bill.holes;
                totalFeet += bill.feet;
                totalAmount += bill.totalAmount;
                
                billsHTML += `
                    <tr>
                        <td>${bill.formattedDate}</td>
                        <td>${bill.drillSize === 'both' ? 'Both' : bill.drillSize + '"'}</td>
                        <td>${bill.holes}</td>
                        <td>${bill.feet.toFixed(2)}</td>
                        <td>₹ ${bill.totalAmount.toFixed(2)}</td>
                        <td>
                            <button class="btn btn-secondary" style="padding: 5px 10px; font-size: 14px;" onclick="viewSingleBill(${compressor.id}, ${bill.id})">
                                <i class="fas fa-eye"></i> View
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            // Add totals row
            billsHTML += `
                    <tr style="background-color: #e8f4ff; font-weight: bold;">
                        <td colspan="2">TOTAL</td>
                        <td>${totalHoles}</td>
                        <td>${totalFeet.toFixed(2)}</td>
                        <td>₹ ${totalAmount.toFixed(2)}</td>
                        <td></td>
                    </tr>
                </tbody>
                </table>
                
                <div class="action-buttons" style="margin-top: 20px;">
                    <button class="btn btn-success" onclick="downloadAllBillsAsPDF(${compressor.id}, '${filterDate}')">
                        <i class="fas fa-file-pdf"></i> Download Bills PDF
                    </button>
                </div>
            `;
            
            searchResults.innerHTML = billsHTML;
            
            // Also show summary in main content area
            mainContentArea.innerHTML = `
                <div class="bill-details">
                    <h2 class="section-title"><i class="fas fa-chart-bar"></i> Summary for ${compressor.name}</h2>
                    ${filterDate ? `<p style="color: #666; margin-bottom: 15px;">Filtered by date: ${formatDate(filterDate)}</p>` : ''}
                    
                    <div class="compressor-info">
                        <h3>${compressor.name}</h3>
                        <p><strong>Tractors:</strong> ${compressor.tractors.length > 0 ? compressor.tractors.join(', ') : 'Not specified'}</p>
                        <p><strong>Bank Account:</strong> ${compressor.bankAccount}</p>
                        <p><strong>IFSC:</strong> ${compressor.ifsc}</p>
                        <p><strong>PAN:</strong> ${compressor.pan}</p>
                    </div>
                    
                    <div class="bill-row">
                        <span class="bill-label">Total Bills:</span>
                        <span class="bill-value">${compressor.bills.length}</span>
                    </div>
                    
                    <div class="bill-row">
                        <span class="bill-label">Filtered Bills:</span>
                        <span class="bill-value">${filteredBills.length}</span>
                    </div>
                    
                    <div class="bill-row">
                        <span class="bill-label">Total Holes:</span>
                        <span class="bill-value">${totalHoles}</span>
                    </div>
                    
                    <div class="bill-row">
                        <span class="bill-label">Total Feet:</span>
                        <span class="bill-value">${totalFeet.toFixed(2)} ft</span>
                    </div>
                    
                    <div class="bill-row total-row">
                        <span class="bill-label">Total Amount:</span>
                        <span class="bill-value">₹ ${totalAmount.toFixed(2)}</span>
                    </div>
                </div>
            `;
        }

        // View single bill
        window.viewSingleBill = function(compressorId, billId) {
            const compressor = compressorData.find(c => c.id === compressorId);
            if (compressor) {
                const bill = compressor.bills.find(b => b.id === billId);
                if (bill) {
                    showBillDetails(bill, compressor);
                }
            }
        };

        // Perform search
        function performSearch() {
            const compressorId = parseInt(searchCompressorSelect.value);
            if (!compressorId) {
                searchResults.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <h3>Select a Compressor</h3>
                        <p>Please select a compressor to view bill details</p>
                    </div>
                `;
                
                mainContentArea.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <h3>Select a Compressor</h3>
                        <p>Please select a compressor to view bill details</p>
                    </div>
                `;
                return;
            }
            
            const compressor = compressorData.find(c => c.id === compressorId);
            if (compressor) {
                showCompressorBills(compressor);
            }
        }

        // Clear search filter
        function clearSearchFilter() {
            searchCompressorSelect.value = '';
            searchDateInput.value = '';
            searchResults.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-search"></i>
                    <h3>Search for compressor bills</h3>
                    <p>Select a compressor to view bill details</p>
                </div>
            `;
            
            mainContentArea.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-search"></i>
                    <h3>Search for compressor bills</h3>
                    <p>Select a compressor to view bill details</p>
                </div>
            `;
        }

        // Clear form
        function clearForm() {
            holesInput.value = '';
            feetInput.value = '';
            document.getElementById('size-both').checked = true;
            totalAmountElement.textContent = '₹ 0.00';
            
            // Reset date to today
            const today = new Date().toISOString().split('T')[0];
            billDateInput.value = today;
            
            if (compressorSelect.value) {
                calculateTotal();
            }
        }

        // Download bill as PDF
        function downloadBillAsPDF(bill, compressor) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add logo/title
            doc.setFontSize(20);
            doc.setTextColor(44, 62, 80);
            doc.text('Compressor Payment Bill', 105, 15, { align: 'center' });
            
            doc.setFontSize(12);
            doc.setTextColor(100, 100, 100);
            doc.text('Bill Date: ' + bill.formattedDate, 105, 25, { align: 'center' });
            
            // Add a line
            doc.setDrawColor(74, 100, 145);
            doc.setLineWidth(0.5);
            doc.line(20, 30, 190, 30);
            
            // Compressor details
            doc.setFontSize(14);
            doc.setTextColor(44, 62, 80);
            doc.text('Compressor Details:', 20, 40);
            
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            doc.text('Name: ' + compressor.name, 20, 50);
            doc.text('Tractors: ' + (compressor.tractors.length > 0 ? compressor.tractors.join(', ') : 'Not specified'), 20, 58);
            doc.text('Bank Account: ' + compressor.bankAccount, 20, 66);
            doc.text('IFSC Code: ' + compressor.ifsc, 20, 74);
            doc.text('PAN Card: ' + compressor.pan, 20, 82);
            
            // Bill details
            doc.setFontSize(14);
            doc.setTextColor(44, 62, 80);
            doc.text('Bill Details:', 20, 95);
            
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            
            const billDetails = [
                ['Drill Size:', bill.drillSize === 'both' ? 'Both 5" & 5.5"' : bill.drillSize + '"'],
                ['Number of Holes:', bill.holes],
                ['Total Feet:', bill.feet.toFixed(2) + ' ft'],
                ['Rate per Foot:', '₹ ' + bill.rate.toFixed(2)],
                ['Total Amount:', '₹ ' + bill.totalAmount.toFixed(2)]
            ];
            
            let yPos = 105;
            billDetails.forEach(detail => {
                doc.text(detail[0], 20, yPos);
                doc.text(detail[1].toString(), 80, yPos);
                yPos += 8;
            });
            
            // Add footer
            doc.setFontSize(10);
            doc.setTextColor(100, 100, 100);
            doc.text('Generated by Compressor Payment Management System', 105, 280, { align: 'center' });
            
            // Save the PDF
            doc.save(`Bill_${compressor.name.replace(/\s+/g, '_')}_${bill.date.replace(/\//g, '-')}.pdf`);
        }

        // Download all bills for a compressor as PDF
        window.downloadAllBillsAsPDF = function(compressorId, filterDate = '') {
            const compressor = compressorData.find(c => c.id === compressorId);
            if (!compressor || compressor.bills.length === 0) {
                alert('No bills found for this compressor');
                return;
            }
            
            // Filter bills if date is provided
            let billsToExport = compressor.bills;
            if (filterDate) {
                billsToExport = compressor.bills.filter(bill => bill.date === filterDate);
            }
            
            if (billsToExport.length === 0) {
                alert('No bills found for the selected filter');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add title
            doc.setFontSize(20);
            doc.setTextColor(44, 62, 80);
            doc.text('Compressor Payment Report', 105, 15, { align: 'center' });
            
            doc.setFontSize(12);
            doc.setTextColor(100, 100, 100);
            doc.text(compressor.name, 105, 25, { align: 'center' });
            doc.text('Report Date: ' + new Date().toLocaleDateString('en-GB'), 105, 32, { align: 'center' });
            
            if (filterDate) {
                doc.text('Filtered Date: ' + formatDate(filterDate), 105, 39, { align: 'center' });
            }
            
            // Compressor details
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            doc.text('Bank Account: ' + compressor.bankAccount, 20, 50);
            doc.text('IFSC Code: ' + compressor.ifsc, 20, 57);
            doc.text('PAN Card: ' + compressor.pan, 20, 64);
            
            // Add a line
            doc.setDrawColor(74, 100, 145);
            doc.setLineWidth(0.5);
            doc.line(20, 70, 190, 70);
            
            // Create table data
            const tableData = billsToExport.map(bill => [
                bill.formattedDate,
                bill.drillSize === 'both' ? 'Both' : bill.drillSize + '"',
                bill.holes,
                bill.feet.toFixed(2),
                '₹ ' + bill.totalAmount.toFixed(2)
            ]);
            
            // Calculate totals
            const totalHoles = billsToExport.reduce((sum, bill) => sum + bill.holes, 0);
            const totalFeet = billsToExport.reduce((sum, bill) => sum + bill.feet, 0);
            const totalAmount = billsToExport.reduce((sum, bill) => sum + bill.totalAmount, 0);
            
            // Add totals row
            tableData.push(['TOTAL', '', totalHoles, totalFeet.toFixed(2), '₹ ' + totalAmount.toFixed(2)]);
            
            // Create table
            doc.autoTable({
                startY: 75,
                head: [['Date', 'Drill Size', 'Holes', 'Feet', 'Amount']],
                body: tableData,
                headStyles: { fillColor: [74, 100, 145], textColor: [255, 255, 255] },
                footStyles: { fillColor: [232, 244, 255] },
                didDrawPage: function(data) {
                    // Footer
                    doc.setFontSize(10);
                    doc.setTextColor(100, 100, 100);
                    doc.text('Page ' + doc.internal.getNumberOfPages(), 105, 285, { align: 'center' });
                }
            });
            
            // Save the PDF
            const fileName = filterDate 
                ? `Report_${compressor.name.replace(/\s+/g, '_')}_${filterDate}.pdf`
                : `Full_Report_${compressor.name.replace(/\s+/g, '_')}.pdf`;
            doc.save(fileName);
        };

        // Download attendance PDF
        window.downloadAttendancePDF = function() {
            if (!appState.currentMonthAttendance) {
                alert('Please generate attendance report first');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('landscape');
            const attendance = appState.currentMonthAttendance;
            
            // Add title
            doc.setFontSize(20);
            doc.setTextColor(44, 62, 80);
            doc.text('Compressor Attendance Report', 148, 15, { align: 'center' });
            
            doc.setFontSize(12);
            doc.setTextColor(100, 100, 100);
            doc.text(`${attendance.monthName} ${attendance.year}`, 148, 25, { align: 'center' });
            doc.text(`Generated on: ${new Date().toLocaleDateString('en-GB')}`, 148, 32, { align: 'center' });
            
            // Create table data
            const tableData = attendance.data.map(compressor => {
                const row = [compressor.name];
                
                // Add day columns
                for (let i = 0; i < attendance.daysInMonth; i++) {
                    row.push(compressor.days[i].present ? 'P' : '');
                }
                
                // Add totals
                row.push(compressor.totalPresent.toString());
                const attendanceRate = attendance.workingDays > 0 ? 
                    Math.round((compressor.totalPresent / attendance.workingDays) * 100) : 0;
                row.push(`${attendanceRate}%`);
                
                return row;
            });
            
            // Create headers
            const headers = ['Compressor Name'];
            for (let i = 1; i <= attendance.daysInMonth; i++) {
                headers.push(i.toString());
            }
            headers.push('Present Days');
            headers.push('Attendance %');
            
            // Create table
            doc.autoTable({
                startY: 40,
                head: [headers],
                body: tableData,
                headStyles: { fillColor: [74, 100, 145], textColor: [255, 255, 255] },
                columnStyles: {
                    0: { cellWidth: 60 },
                    ...Array.from({length: attendance.daysInMonth}, (_, i) => ({[i+1]: {cellWidth: 10}}))
                },
                didDrawCell: function(data) {
                    // Color code present/absent cells
                    if (data.column.index > 0 && data.column.index <= attendance.daysInMonth && data.cell.raw === 'P') {
                        doc.setFillColor(212, 237, 218);
                        doc.setTextColor(21, 87, 36);
                        doc.rect(data.cell.x, data.cell.y, data.cell.width, data.cell.height, 'F');
                        doc.setTextColor(21, 87, 36);
                    } else if (data.column.index > 0 && data.column.index <= attendance.daysInMonth && data.cell.raw === '') {
                        doc.setFillColor(248, 215, 218);
                        doc.setTextColor(114, 28, 36);
                        doc.rect(data.cell.x, data.cell.y, data.cell.width, data.cell.height, 'F');
                        doc.setTextColor(114, 28, 36);
                    }
                },
                didDrawPage: function(data) {
                    // Footer
                    doc.setFontSize(10);
                    doc.setTextColor(100, 100, 100);
                    doc.text(`Page ${doc.internal.getNumberOfPages()}`, 210, 200, { align: 'center' });
                }
            });
            
            // Save the PDF
            doc.save(`Attendance_${attendance.monthName}_${attendance.year}.pdf`);
        };

        // Download summary PDF
        function downloadSummaryPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add title
            doc.setFontSize(20);
            doc.setTextColor(44, 62, 80);
            doc.text('Compressor System Summary Report', 105, 15, { align: 'center' });
            
            doc.setFontSize(12);
            doc.setTextColor(100, 100, 100);
            doc.text('Generated on: ' + new Date().toLocaleDateString('en-GB'), 105, 25, { align: 'center' });
            
            // Get all data
            const allBills = getAllBills();
            const ftdBills = getFTDBills();
            const mtdBills = getMTDBills();
            const ytdBills = getYTDBills();
            
            // Calculate totals
            let totalCompressors = compressorData.length;
            let totalBills = allBills.length;
            let totalHoles = 0;
            let totalFeet = 0;
            let totalAmount = 0;
            
            allBills.forEach(bill => {
                totalHoles += bill.holes;
                totalFeet += bill.feet;
                totalAmount += bill.totalAmount;
            });
            
            // Calculate FTD totals
            let ftdHoles = 0;
            let ftdFeet = 0;
            let ftdAmount = 0;
            ftdBills.forEach(bill => {
                ftdHoles += bill.holes;
                ftdFeet += bill.feet;
                ftdAmount += bill.totalAmount;
            });
            
            // Calculate MTD totals
            let mtdHoles = 0;
            let mtdFeet = 0;
            let mtdAmount = 0;
            mtdBills.forEach(bill => {
                mtdHoles += bill.holes;
                mtdFeet += bill.feet;
                mtdAmount += bill.totalAmount;
            });
            
            // Calculate YTD totals
            let ytdHoles = 0;
            let ytdFeet = 0;
            let ytdAmount = 0;
            ytdBills.forEach(bill => {
                ytdHoles += bill.holes;
                ytdFeet += bill.feet;
                ytdAmount += bill.totalAmount;
            });
            
            // Add summary section
            doc.setFontSize(16);
            doc.setTextColor(44, 62, 80);
            doc.text('Overall Summary', 20, 40);
            
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            
            const summaryData = [
                ['Total Compressors:', totalCompressors],
                ['Total Bills:', totalBills],
                ['Total Holes:', totalHoles],
                ['Total Feet:', totalFeet.toFixed(2)],
                ['Total Amount:', '₹ ' + totalAmount.toFixed(2)],
                ['FTD Amount:', '₹ ' + ftdAmount.toFixed(2)],
                ['MTD Amount:', '₹ ' + mtdAmount.toFixed(2)],
                ['YTD Amount:', '₹ ' + ytdAmount.toFixed(2)],
                ['Average per Foot:', '₹ ' + (totalFeet > 0 ? (totalAmount/totalFeet).toFixed(2) : '0.00')]
            ];
            
            let yPos = 50;
            summaryData.forEach(item => {
                doc.text(item[0], 20, yPos);
                doc.text(item[1].toString(), 80, yPos);
                yPos += 8;
            });
            
            // Add a line
            doc.setDrawColor(74, 100, 145);
            doc.setLineWidth(0.5);
            doc.line(20, yPos + 5, 190, yPos + 5);
            
            // Add compressor-wise summary
            yPos += 15;
            doc.setFontSize(16);
            doc.setTextColor(44, 62, 80);
            doc.text('Compressor-wise Summary', 20, yPos);
            
            yPos += 10;
            
            // Create table data for compressor summary
            const tableData = compressorData.map(compressor => {
                const compressorHoles = compressor.bills.reduce((sum, bill) => sum + bill.holes, 0);
                const compressorFeet = compressor.bills.reduce((sum, bill) => sum + bill.feet, 0);
                const compressorAmount = compressor.bills.reduce((sum, bill) => sum + bill.totalAmount, 0);
                
                return [
                    compressor.name.substring(0, 20),
                    compressor.bills.length,
                    compressorHoles,
                    compressorFeet.toFixed(2),
                    '₹ ' + compressorAmount.toFixed(2)
                ];
            });
            
            // Create table
            doc.autoTable({
                startY: yPos,
                head: [['Compressor', 'Bills', 'Holes', 'Feet', 'Amount']],
                body: tableData,
                headStyles: { fillColor: [74, 100, 145], textColor: [255, 255, 255] },
                columnStyles: {
                    0: { cellWidth: 60 },
                    1: { cellWidth: 20 },
                    2: { cellWidth: 20 },
                    3: { cellWidth: 30 },
                    4: { cellWidth: 40 }
                },
                didDrawPage: function(data) {
                    // Footer
                    doc.setFontSize(10);
                    doc.setTextColor(100, 100, 100);
                    doc.text('Page ' + doc.internal.getNumberOfPages(), 105, 285, { align: 'center' });
                }
            });
            
            // Save the PDF
            doc.save('Compressor_System_Summary_Report.pdf');
        }

        // Initialize the application when the page loads
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
